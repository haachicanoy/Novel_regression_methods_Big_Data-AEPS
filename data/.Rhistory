trans_data$Unidad_categorizada[which(trans_data$Distrito=='Chongoyape' & trans_data$`Unidad muestreada`=='Overazal')] <- 'Overazal'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Chongoyape' & trans_data$`Unidad muestreada`=='PAMPAGRANDE')] <- 'Pampa_Grande'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Chongoyape' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Chongoyape')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Chongoyape')])
# =========================== #
# Distrito == Jose_Ortiz
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Jose_Ortiz')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Jose_Ortiz')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Jose_Ortiz' & trans_data$`Unidad muestreada`=='1.-Samillan')] <- 'Samillan'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Jose_Ortiz' & trans_data$`Unidad muestreada`=='2-San Nicolas')] <- 'San_Nicolas'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Jose_Ortiz' & trans_data$`Unidad muestreada`=='3.Chilape')] <- 'Chilape'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Jose_Ortiz' & trans_data$`Unidad muestreada`=='4-Culpon')] <- 'Culpon'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Jose_Ortiz' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Jose_Ortiz')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Jose_Ortiz')])
# =========================== #
# Distrito == La_Victoria
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='La_Victoria')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='La_Victoria')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='La_Victoria' & trans_data$`Unidad muestreada`=='1-Yortuque')] <- 'Yortuque'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='La_Victoria' & trans_data$`Unidad muestreada`=='2-Tocnope')] <- 'Tocnope'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='La_Victoria' & trans_data$`Unidad muestreada`=='3.- Chacupe')] <- 'Chacupe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='La_Victoria' & trans_data$`Unidad muestreada`=='4-Yalcuchique')] <- 'Yalcuchique'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='La_Victoria' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='La_Victoria')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='La_Victoria')])
# =========================== #
# Distrito == Lagunas
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Lagunas')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Lagunas')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='1-Coloche')] <- 'Coloche'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='1-Mamey')] <- 'Mamey'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='1-Mamey Ucupe')] <- 'Mamey-Ucupe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='2-Mamey')] <- 'Mamey'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='2 Teodora ')] <- 'Teodora'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='3-La Manga')] <- 'La_Manga'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='3-La Teodora')] <- 'Teodora'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='4-Ucupe')] <- 'Ucupe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='5.-Rafan')] <- 'Rafan'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Lagunas')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Lagunas')])
# =========================== #
# Distrito == Monsefu
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Monsefu')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Monsefu')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='1.-Valle Hermoso')] <- 'Valle_Hermoso'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='2-Micarcape')] <- 'Micarcape'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='3.Callanca')] <- 'Callanca'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='3.Cusupe')] <- 'Cusupe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='4-Cusupe')] <- 'Cusupe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='4.-Callanca')] <- 'Callanca'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='4.-Cusupe')] <- 'Cusupe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='5.-Pueblo')] <- 'Pueblo'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Monsefu')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Monsefu')])
# =========================== #
# Distrito == Nueva_Arica
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Nueva_Arica')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Nueva_Arica')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Nueva_Arica' & trans_data$`Unidad muestreada`=='1-Nueva Arica')] <- 'Nueva_Arica'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Nueva_Arica' & trans_data$`Unidad muestreada`=='2.-Dos Cruces')] <- 'Dos_Cruces'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Nueva_Arica' & trans_data$`Unidad muestreada`=='3-Zapotal ')] <- 'Zapotal'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Nueva_Arica' & trans_data$`Unidad muestreada`=='4-Saldaña')] <- 'Saldaña'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Nueva_Arica' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Nueva_Arica')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Nueva_Arica')])
# =========================== #
# Distrito == Oyotun
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Oyotun')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Oyotun')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`==' 7.-Batan-Potrero')] <- 'Batan-Potrero'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`==' 8.-Batan-Potrero')] <- 'Batan-Potrero'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='1-Bebedero')] <- 'Bebedero'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='2-Espinal')] <- 'Espinal'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='3.- Viru')] <- 'Viru'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='4.- Collao - Huaca de toro')] <- 'Collao-Huaca_del_toro'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='4.- Collao - Huella de toro')] <- 'Collao-Huaca_del_toro'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='5.- Collao - Huaca de toro')] <- 'Collao-Huaca_del_toro'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='5.Chumbenique')] <- 'Chumbenique'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='6. Gramadal Palmo')] <- 'Gramadal_Palmo'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='7. Gramadal Palmo')] <- 'Gramadal_Palmo'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Oyotun')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Oyotun')])
# =========================== #
# Distrito == Patapo
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Patapo')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Patapo')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='1-Canteras')] <- 'Canteras'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='1-Canteras I')] <- 'Canteras'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='2-CanterasII')] <- 'Canteras'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='2-Desaguadero')] <- 'Desaguadero'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='3-Desaguadero')] <- 'Desaguadero'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='3-Pampa de burros')] <- 'Pampa_de_burros'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='3-Pampa de Burros')] <- 'Pampa_de_burros'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='3-Tulipe ')] <- 'Tulipe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='4-Pampa de Burros')] <- 'Pampa_de_burros'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='4-Tulipe ')] <- 'Tulipe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='5-Batangrande-Posope Bajo')] <- 'Batangrande-Posope_Bajo'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='6-Batangrande-Posope Bajo')] <- 'Batangrande-Posope_Bajo'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Patapo')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Patapo')])
# =========================== #
# Distrito == Picsi
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Picsi')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Picsi')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Picsi' & trans_data$`Unidad muestreada`=='1-Chucupe')] <- 'Chucupe'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Picsi' & trans_data$`Unidad muestreada`=='2-Fala')] <- 'Fala'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Picsi' & trans_data$`Unidad muestreada`=='3-Jarrin')] <- 'Jarrin'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Picsi' & trans_data$`Unidad muestreada`=='4 El padre-')] <- 'El_padre'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Picsi' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Picsi')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Picsi')])
# =========================== #
# Distrito == Pimentel
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Pimentel')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Pimentel')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pimentel' & trans_data$`Unidad muestreada`=='1 COIS')] <- 'Cois'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pimentel' & trans_data$`Unidad muestreada`=='2-Yortuque')] <- 'Yortuque'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pimentel' & trans_data$`Unidad muestreada`=='3-Pulen')] <- 'Pulen'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pimentel' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Pimentel')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pimentel')])
# =========================== #
# Distrito == Pomalca
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Pomalca')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Pomalca')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pomalca' & trans_data$`Unidad muestreada`=='1-Saman')] <- 'Saman'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pomalca' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Pomalca')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pomalca')])
# =========================== #
# Distrito == Pucala
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Pucala')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Pucala')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pucala' & trans_data$`Unidad muestreada`=='1-Pucala')] <- 'Pucala'
table(trans_data$Distrito[which(trans_data$Distrito=='Pucala')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Pucala')])
# =========================== #
# Distrito == Tuman
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Tuman')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Tuman')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Tuman' & trans_data$`Unidad muestreada`=='TUMAN')] <- 'Tuman'
table(trans_data$Distrito[which(trans_data$Distrito=='Tuman')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Tuman')])
# =========================== #
# Distrito == Zaña
# =========================== #
table(trans_data$Distrito[which(trans_data$Distrito=='Zaña')], trans_data$`Unidad muestreada`[which(trans_data$Distrito=='Zaña')])
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Zaña' & trans_data$`Unidad muestreada`=='1-Zaña')] <- 'Zaña'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Zaña' & trans_data$`Unidad muestreada`=='2-San Nicolas')] <- 'San_Nicolas'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Zaña' & trans_data$`Unidad muestreada`=='2-Zaña')] <- 'Zaña'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Zaña' & trans_data$`Unidad muestreada`=='3-Collique Bajo')] <- 'Collique_Bajo'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Zaña' & trans_data$`Unidad muestreada`=='4.-La Otra Banda')] <- 'La_Otra_Banda'
trans_data$Unidad_categorizada[which(trans_data$Distrito=='Zaña' & trans_data$`Unidad muestreada`=='Agregado')] <- 'Agregado'
table(trans_data$Distrito[which(trans_data$Distrito=='Zaña')], trans_data$Unidad_categorizada[which(trans_data$Distrito=='Zaña')])
# ========================================================================================================== #
# Create new variables from 'Campaña' and 'month'
# ========================================================================================================== #
year_camp <- strsplit(trans_data$Campaña, split='-')
year_camp <- lapply(1:nrow(trans_data),function(i)
{
if(length(grep(trans_data$month[i],pattern='_A$',perl=T,value=T))>0){
year_camp[i] <- as.vector(year_camp[[i]][1])
} else {
year_camp[i] <- as.vector(year_camp[[i]][2])
}
return(year_camp[i])
})
year_camp <- unlist(year_camp)
trans_data$year <- year_camp; rm(year_camp)
trans_data$month_c <- gsub(pattern='_A$|_B$', replacement='', x=trans_data$month)
trans_data$month_c <- gsub(pattern='Ene', replacement='01', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Feb', replacement='02', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Mar', replacement='03', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Abr', replacement='04', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='May', replacement='05', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Jun', replacement='06', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Jul', replacement='07', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Ago', replacement='08', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Sep', replacement='09', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Oct', replacement='10', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Nov', replacement='11', x=trans_data$month_c)
trans_data$month_c <- gsub(pattern='Dic', replacement='12', x=trans_data$month_c)
library(zoo)
trans_data$date <- as.yearmon(paste(trans_data$year,'-',trans_data$month_c,sep=''))
trans_data <- trans_data[,c('Provincia','Distrito','Unidad muestreada','Unidad_categorizada','Campaña','month','year','month_c','date',
'Cosechas','Precio_chacra','Produccion','Siembras','Superficie_perdida','Superficie_verde','Rendimiento')]
trans_data2 <- trans_data
# Ago_B Sep_B Oct_B Nov_B Dic_B
mtch <- c(grep(pattern='Ago_B', x=trans_data2$month, fixed=T),
grep(pattern='Sep_B', x=trans_data2$month, fixed=T),
grep(pattern='Oct_B', x=trans_data2$month, fixed=T),
grep(pattern='Nov_B', x=trans_data2$month, fixed=T),
grep(pattern='Dic_B', x=trans_data2$month, fixed=T))
mtch <- sort(mtch)
mtch <- setdiff(1:nrow(trans_data2),mtch)
trans_data2 <- trans_data2[mtch,]
trans_data2 <- trans_data2 %>% arrange(Distrito, Unidad_categorizada, year)
rm(mtch)
trans_data2$ID_row <- 1:nrow(trans_data2)
trans_data2$evento <- NA
distList <- unique(trans_data2$Distrito)
for(i in 1:length(distList))
{
subData <- trans_data2[which(trans_data2$Distrito==paste(distList[i])),]
uniList  <- unique(subData$Unidad_categorizada)
for(j in 1:length(uniList))
{
mtch <- subData$ID_row[which(subData$Unidad_categorizada==paste(uniList[j]) & !is.na(subData$Rendimiento))]
if(length(mtch)>0){
trans_data2$evento[mtch] <- 1:length(mtch); rm(mtch)
} else{
cat('This "Unidad_categorizada" has not harvest events\n')
}
}
}; rm(distList,i,subData,uniList,j,mtch)
trans_data2$ID_row <- NULL
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)]
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)]
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)]
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)] <- paste('00',trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)],sep='')
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)] <- paste('0',trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)],sep='')
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)]
trans_data2 <- trans_data
# Ago_B Sep_B Oct_B Nov_B Dic_B
mtch <- c(grep(pattern='Ago_B', x=trans_data2$month, fixed=T),
grep(pattern='Sep_B', x=trans_data2$month, fixed=T),
grep(pattern='Oct_B', x=trans_data2$month, fixed=T),
grep(pattern='Nov_B', x=trans_data2$month, fixed=T),
grep(pattern='Dic_B', x=trans_data2$month, fixed=T))
mtch <- sort(mtch)
mtch <- setdiff(1:nrow(trans_data2),mtch)
trans_data2 <- trans_data2[mtch,]; rm(mtch)
trans_data2 <- trans_data2 %>% arrange(Distrito, Unidad_categorizada, year)
# ========================================================================================================== #
# Create 'ID' and 'Evento' variable
# ========================================================================================================== #
# =========================== #
# Create 'evento' variable
# =========================== #
trans_data2$ID_row <- 1:nrow(trans_data2)
trans_data2$evento <- NA
distList <- unique(trans_data2$Distrito)
for(i in 1:length(distList))
{
subData <- trans_data2[which(trans_data2$Distrito==paste(distList[i])),]
uniList  <- unique(subData$Unidad_categorizada)
for(j in 1:length(uniList))
{
mtch <- subData$ID_row[which(subData$Unidad_categorizada==paste(uniList[j]) & !is.na(subData$Rendimiento))]
if(length(mtch)>0){
trans_data2$evento[mtch] <- 1:length(mtch); rm(mtch)
} else{
cat('This "Unidad_categorizada" has not harvest events\n')
}
}
}; rm(distList,i,subData,uniList,j,mtch)
trans_data2$ID_row <- NULL
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)]
paste('00',trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)],sep='')
length(paste('00',trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)],sep=''))
length(trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)])
str(trans_data2)
trans_data2$evento <- as.character(trans_data2$evento)
str(trans_data2)
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)]
length(trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)])
paste('0',trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)],sep='')
length(paste('0',trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)],sep=''))
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)] <- paste('00',trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==1)],sep='')
trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)] <- paste('0',trans_data2$evento[which(!is.na(trans_data2$evento) & nchar(trans_data2$evento)==2)],sep='')
trans_data2$evento
trans_data2$idEvento <- NA
[which(!is.na(trans_data2$evento))]
[which(!is.na(trans_data2$evento)]
which(!is.na(trans_data2$evento)
)
which(!is.na(trans_data2$evento))
paste(trans_data2$Provincia,'/',trans_data2$Distrito,'/',trans_data2$Unidad_categorizada,'/',trans_data2$year,'/',trans_data2$month_c,'/',trans_data2$evento, sep='')[which(!is.na(trans_data2$evento))]
trans_data2$idEvento[which(!is.na(trans_data2$evento))] <- paste(trans_data2$Provincia,'/',trans_data2$Distrito,'/',trans_data2$Unidad_categorizada,'/',trans_data2$year,'/',trans_data2$month_c,'/',trans_data2$evento, sep='')[which(!is.na(trans_data2$evento))]
trans_data2 <- trans_data2[,c('Provincia','Distrito','Unidad muestreada','Unidad_categorizada','Campaña','month','year','month_c','date','evento','idEvento',
'Cosechas','Precio_chacra','Produccion','Siembras','Superficie_perdida','Superficie_verde','Rendimiento')]
View(trans_data2)
15+5+70
15+5+70+50
20+15+105
write.csv(x=trans_data2, file='D:/ToBackup/AEPS-Big data/Peru_database/arroz_chiclayo/BDD_consolidada_campana.csv', row.names=FALSE)
download.file(url='ftp://ftp.ciat.cgiar.org/DAPA/projects/BIGDATA_AEPS/TOY_SETS/estacionClimatica.csv',destfile='D:/ToBackup/AEPS-Big data/Novel_regression_methods/data/estacionClimatica.csv',method='curl')
download.file(url='ftp://ftp.ciat.cgiar.org/DAPA/projects/BIGDATA_AEPS/TOY_SETS/estacionClimatica.csv',destfile='D:/ToBackup/AEPS-Big data/Novel_regression_methods/data/estacionClimatica.csv',method='internal')
download.file(url='ftp://ftp.ciat.cgiar.org/DAPA/projects/BIGDATA_AEPS/TOY_SETS/eventosDeCosecha.csv',
destfile='C:/Users/haachicanoy/Documents/GitHub/Novel_regression_methods_Big_Data-AEPS/data/eventosDeCosecha.csv',method='internal')
setwd('C:/Users/haachicanoy/Documents/GitHub/Novel_regression_methods_Big_Data-AEPS/data')
g <- gc()
rm(list = ls())
setwd('C:/Users/haachicanoy/Documents/GitHub/Novel_regression_methods_Big_Data-AEPS/data')
library(readr)
management <- read_csv(file='eventosDeCosecha.csv')
View(management)
management <- read_csv(file='eventosDeCosecha.csv',rownames=1)
management <- read_csv(file='eventosDeCosecha.csv',row.names=1)
?read_csv
management <- read.csv(file='eventosDeCosecha.csv',row.names=1)
View(management)
str(management)
View(management)
climate <- read.csv(file='estacionClimatica.csv')
View(climate)
plot(climate$ESOL)
plot(climate$ESOL,type='l')
plot(climate$RAIN,type='l')
plot(climate$RHUM,type='l')
plot(climate$TMAX,type='l')
plot(climate$TMIN,type='l')
hist(management$Yield)
names(climate)
names(management)
names(climate)[1] <- 'Sowing_Date'
data <- merge(management, climate, by='Sowing_Date')
View(data)
rm(management, climate)
library(plspm)
View(data)
cor(data)
cor(data$TMAX, data$TMIN)
plot(data$TMAX, data$TMIN)
plot(data$RAIN, data$TMIN)
plot(data$RAIN, data$TMAX)
plot(data$RAIN, data$ESOL)
plot(data$TMAX, data$ESOL)
unifDatos <- function(climFiles,namesC,formFecha="%Y-%m-%d")
{
listaInfo      <- lapply(climFiles,function(x){read.table(x,header=T)})
FECHA          <- as.Date(listaInfo[[1]][,1],format = formFecha)
listProces     <- lapply(listaInfo,function(x){x[,2]})
listCompleta   <- do.call(cbind,listProces)
dfListCompleta <- data.frame(FECHA,as.data.frame(listCompleta))
names(dfListCompleta) <- c("FECHA",namesC)
return(dfListCompleta)
}
vinculClima <- function(baseCosecha,climBase,fsiem="FECHA_SIEMBRA",fcos="FECHA.DE.COSECHA")
{
nEven <- nrow(baseCosecha)
##Por evento extrae el vector de fechas entre siembra y cosecha
fechaEvent  <- lapply(1:nEven,function(x){fecha <- as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],origin = "1970-01-01");return(as.data.frame(fecha))})
##Por vector de fechas de cada evento asigna variables de clima
eventosCosech <- lapply(1:nEven,function(x){merge(fechaEvent[[x]],climBase,by.x="fecha",by.y="FECHA",all.x=T,all.y=F)})
#Calculando algunos indicadores para el primer evento
#with(eventosCosech[[1]], c(mean(tempMed),mean(tempMin),mean(tempMax),sum(gradDia),mean(humRelMed),sum(lluvia),sum(HorasTempMay24),sum(HorasTemp28_30),sum(HorasTemp30_32),sum(HorasTemp32_34),sum(HorasTempMay34)) )
#Calculando algunos indicadores para todos los eventos
Indicadores=lapply(1:nEven, function(x){Indicadores<-with(eventosCosech[[x]],c( mean(TMAX),mean(TMIN),mean((TMAX-TMIN)/2),mean(TMAX-TMIN),sum(ESOL),sum(TMAX>34),sum(RAIN),sum(RAIN>=10)) );return(as.data.frame(Indicadores))})
nomrows=c("Temp_Max_Avg","Temp_Min_Avg","Temp_Avg",  "Diurnal_Range_Avg",	"Sol_Ener_Accu"	,"Temp_Max_34_Freq","Rain_Accu","Rain_10_Freq")
sa=as.data.frame(Indicadores)
row.names(sa)=nomrows
climEvent=as.data.frame(t(sa))
#Union de indicadores clima y eventos
joint=as.data.frame(cbind(baseCosecha,climEvent))
return(joint)
}
management <- read.csv(file='eventosDeCosecha.csv',row.names=1)
climate <- read.csv(file='estacionClimatica.csv')
names(management)
data <- vinculClima(management,climate,fsiem="Sowing_Date",fcos="Harvest_Date")
data <- vinculClima(baseCosecha=management,climBase=climate,fsiem="Sowing_Date",fcos="Harvest_Date")
baseCosecha = management
climBase = climate
vinculClima <- function(baseCosecha,climBase,fsiem="Sowing_Date",fcos="Harvest_Date")
{
nEven <- nrow(baseCosecha)
##Por evento extrae el vector de fechas entre siembra y cosecha
fechaEvent  <- lapply(1:nEven,function(x){fecha <- as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],origin = "1970-01-01");return(as.data.frame(fecha))})
##Por vector de fechas de cada evento asigna variables de clima
eventosCosech <- lapply(1:nEven,function(x){merge(fechaEvent[[x]],climBase,by.x="fecha",by.y="FECHA",all.x=T,all.y=F)})
#Calculando algunos indicadores para el primer evento
#with(eventosCosech[[1]], c(mean(tempMed),mean(tempMin),mean(tempMax),sum(gradDia),mean(humRelMed),sum(lluvia),sum(HorasTempMay24),sum(HorasTemp28_30),sum(HorasTemp30_32),sum(HorasTemp32_34),sum(HorasTempMay34)) )
#Calculando algunos indicadores para todos los eventos
Indicadores=lapply(1:nEven, function(x){Indicadores<-with(eventosCosech[[x]],c( mean(TMAX),mean(TMIN),mean((TMAX-TMIN)/2),mean(TMAX-TMIN),sum(ESOL),sum(TMAX>34),sum(RAIN),sum(RAIN>=10)) );return(as.data.frame(Indicadores))})
nomrows=c("Temp_Max_Avg","Temp_Min_Avg","Temp_Avg",  "Diurnal_Range_Avg",	"Sol_Ener_Accu"	,"Temp_Max_34_Freq","Rain_Accu","Rain_10_Freq")
sa=as.data.frame(Indicadores)
row.names(sa)=nomrows
climEvent=as.data.frame(t(sa))
#Union de indicadores clima y eventos
joint=as.data.frame(cbind(baseCosecha,climEvent))
return(joint)
}
data <- vinculClima(baseCosecha=management,climBase=climate,fsiem="Sowing_Date",fcos="Harvest_Date")
nEven <- nrow(baseCosecha)
nEven
fechaEvent  <- lapply(1:nEven,function(x){fecha <- as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],origin = "1970-01-01");return(as.data.frame(fecha))})
fsiem="Sowing_Date"
fcos="Harvest_Date"
fechaEvent  <- lapply(1:nEven,function(x){fecha <- as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],origin = "1970-01-01");return(as.data.frame(fecha))})
baseCosecha[fsiem]
x=1
baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x]
as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x])
as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],origin = "1970-01-01")
as.Date(baseCosecha[fsiem][x]:baseCosecha[fcos][x],origin = "1970-01-01")
as.Date(baseCosecha[fsiem][1][x]:baseCosecha[fcos][1][x],origin = "1970-01-01")
baseCosecha[fsiem][1][x]
baseCosecha[fsiem][,11][x]
baseCosecha[fsiem][,1][x]
baseCosecha[fsiem]
baseCosecha[fsiem][,1]
baseCosecha[fsiem][,1][x]
?as.Date
fechaEvent  <- lapply(1:nEven,function(x){fecha <- as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],format='%m-%d-%Y',origin = "01-01-1970");return(as.data.frame(fecha))})
fechaEvent
fechaEvent  <- lapply(1:nEven,function(x){fecha <- as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],format='%m/%d/%Y',origin = "01/01/1970");return(as.data.frame(fecha))})
fechaEvent
names(climBase)
eventosCosech <- lapply(1:nEven,function(x){merge(fechaEvent[[x]],climBase,by.x="fecha",by.y="DATE",all.x=T,all.y=F)})
eventosCosech
head(eventosCosech)
climBase
head(climBase)
climBase$DATE <- as.Date(climBase$DATE, format='%m/%d/%Y', origin="01/01/1970")
head(climBase)
eventosCosech <- lapply(1:nEven,function(x){merge(fechaEvent[[x]],climBase,by.x="fecha",by.y="DATE",all.x=T,all.y=F)})
eventosCosech
Indicadores=lapply(1:nEven, function(x){Indicadores<-with(eventosCosech[[x]],c( mean(TMAX),mean(TMIN),mean((TMAX-TMIN)/2),mean(TMAX-TMIN),sum(ESOL),sum(TMAX>34),sum(RAIN),sum(RAIN>=10)) );return(as.data.frame(Indicadores))})
Indicadores
nomrows=c("Temp_Max_Avg","Temp_Min_Avg","Temp_Avg",  "Diurnal_Range_Avg",	"Sol_Ener_Accu"	,"Temp_Max_34_Freq","Rain_Accu","Rain_10_Freq")
sa=as.data.frame(Indicadores)
row.names(sa)=nomrows
climEvent=as.data.frame(t(sa))
climEvent
joint=as.data.frame(cbind(baseCosecha,climEvent))
joint
vinculClima <- function(baseCosecha,climBase,fsiem="Sowing_Date",fcos="Harvest_Date")
{
nEven <- nrow(baseCosecha)
##Por evento extrae el vector de fechas entre siembra y cosecha
fechaEvent  <- lapply(1:nEven,function(x){fecha <- as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],format='%m/%d/%Y',origin = "01/01/1970");return(as.data.frame(fecha))})
climBase$DATE <- as.Date(climBase$DATE, format='%m/%d/%Y', origin="01/01/1970")
##Por vector de fechas de cada evento asigna variables de clima
eventosCosech <- lapply(1:nEven,function(x){merge(fechaEvent[[x]],climBase,by.x="fecha",by.y="DATE",all.x=T,all.y=F)})
#Calculando algunos indicadores para todos los eventos
Indicadores <- lapply(1:nEven, function(x){Indicadores<-with(eventosCosech[[x]],c( mean(TMAX),mean(TMIN),mean((TMAX-TMIN)/2),mean(TMAX-TMIN),sum(ESOL),sum(TMAX>34),sum(RAIN),sum(RAIN>=10)) );return(as.data.frame(Indicadores))})
nomrows=c("Temp_Max_Avg","Temp_Min_Avg","Temp_Avg",  "Diurnal_Range_Avg",	"Sol_Ener_Accu"	,"Temp_Max_34_Freq","Rain_Accu","Rain_10_Freq")
sa=as.data.frame(Indicadores)
row.names(sa)=nomrows
climEvent=as.data.frame(t(sa))
#Union de indicadores clima y eventos
joint=as.data.frame(cbind(baseCosecha,climEvent))
return(joint)
}
data <- vinculClima(baseCosecha=management,climBase=climate,fsiem="Sowing_Date",fcos="Harvest_Date")
data
View(data)
rm(joint)
rm(management)
rm(sa)
rm(baseCosecha)
rm(climate)
rm(climBase)
rm(climEvent)
rm(eventosCosech)
rm(fcos)
rm(fechaEvent)
rm(fsiem)
rm(Indicadores)
rm(nEven)
rm(nomrows)
rm(x)
data$Sowing_Date <- as.Date(data$Sowing_Date, format='%m/%d/%Y', origin="01/01/1970")
data$Harvest_Date <- as.Date(data$Harvest_Date, format='%m/%d/%Y', origin="01/01/1970")
View(data)
rm(unifDatos())
rm(unifDatos)
rm(vinculClima)
names(data)
data <- data[,c('File_Code','Sowing_Date','Sowing_Month','Harvest_Date','Harvest_Month','Harvest_Year',
'Department','Municipality','Area','Cropping_System_Simple','Variety',
'Temp_Max_Avg','Temp_Min_Avg','Temp_Avg','Diurnal_Range_Avg','Sol_Ener_Accu','Temp_Max_34_Freq','Rain_Accu','Rain_10_Freq',
'Yield')]
View(data)
sort(unique(data$Variety))
table(data$Variety)
table(data$Department)
table(data$Municipality)
table(data$Cropping_Sytem_Simple)
g <- gc()
rm(list = ls())
setwd('C:/Users/haachicanoy/Documents/GitHub/Novel_regression_methods_Big_Data-AEPS/data')
management <- read.csv(file='eventosDeCosecha.csv',row.names=1)
climate <- read.csv(file='estacionClimatica.csv')
vinculClima <- function(baseCosecha,climBase,fsiem="Sowing_Date",fcos="Harvest_Date")
{
nEven <- nrow(baseCosecha)
##Por evento extrae el vector de fechas entre siembra y cosecha
fechaEvent  <- lapply(1:nEven,function(x){fecha <- as.Date(baseCosecha[fsiem][,1][x]:baseCosecha[fcos][,1][x],format='%m/%d/%Y',origin = "01/01/1970");return(as.data.frame(fecha))})
climBase$DATE <- as.Date(climBase$DATE, format='%m/%d/%Y', origin="01/01/1970")
##Por vector de fechas de cada evento asigna variables de clima
eventosCosech <- lapply(1:nEven,function(x){merge(fechaEvent[[x]],climBase,by.x="fecha",by.y="DATE",all.x=T,all.y=F)})
#Calculando algunos indicadores para todos los eventos
Indicadores <- lapply(1:nEven, function(x){Indicadores<-with(eventosCosech[[x]],c( mean(TMAX),mean(TMIN),mean((TMAX-TMIN)/2),mean(TMAX-TMIN),sum(ESOL),sum(TMAX>34),sum(RAIN),sum(RAIN>=10)) );return(as.data.frame(Indicadores))})
nomrows=c("Temp_Max_Avg","Temp_Min_Avg","Temp_Avg",  "Diurnal_Range_Avg",	"Sol_Ener_Accu"	,"Temp_Max_34_Freq","Rain_Accu","Rain_10_Freq")
sa=as.data.frame(Indicadores)
row.names(sa)=nomrows
climEvent=as.data.frame(t(sa))
# Union de indicadores clima y eventos
joint=as.data.frame(cbind(baseCosecha,climEvent))
return(joint)
}
datos <- vinculClima(baseCosecha=management,climBase=climate,fsiem="Sowing_Date",fcos="Harvest_Date")
datos$Sowing_Date <- as.Date(datos$Sowing_Date, format='%m/%d/%Y', origin="01/01/1970")
datos$Harvest_Date <- as.Date(datos$Harvest_Date, format='%m/%d/%Y', origin="01/01/1970")
rm(vinculClima, management, climate)
datos <- datos[,c('File_Code','Sowing_Date','Sowing_Month','Harvest_Date','Harvest_Month','Harvest_Year',
'Department','Municipality','Area','Cropping_System_Simple','Variety',
'Temp_Max_Avg','Temp_Min_Avg','Temp_Avg','Diurnal_Range_Avg','Sol_Ener_Accu','Temp_Max_34_Freq','Rain_Accu','Rain_10_Freq',
'Yield')]
g=gc()
rm(list=ls())
library(devtools)
install_github('RGoogleDocs', 'duncantl')
library(RGoogleDocs)
auth = getGoogleAuth('harold22010@gmail.com', 'welcometohell1')
auth = getGoogleAuth(login = 'harold22010@gmail.com', password = 'welcometohell1')
auth = getGoogleAuth(login = 'harold22010@gmail.com', password = 'welcometohell1')
